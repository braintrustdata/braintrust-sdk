name: OpenAISpans

tests:
  - name: Basic Completions
    description: whatever
    vendor: OpenAI
    endpoint: completions
    request:
      model: gpt-4o-mini
      messages:
        - role: system
          content: "you are a helpful assistant"
        - role: user
          content: "What is the capital of France?"
    wiremock: |
      {
        "request": {
          "method": "POST",
          "url": "/chat/completions"
        },
        "response": {
          "status": 200,
          "headers": {
            "Content-Type": "application/json"
          },
          "body": {
            "id": "chatcmpl-test123",
            "object": "chat.completion",
            "created": 1677652288,
            "model": "gpt-4o-mini",
            "choices": [
              {
                "index": 0,
                "message": {
                  "role": "assistant",
                  "content": "The capital of France is Paris."
                },
                "finish_reason": "stop"
              }
            ],
            "usage": {
              "prompt_tokens": 20,
              "completion_tokens": 8,
              "total_tokens": 28
            }
          }
        }
      }
    otel_span:
      span_name: OAI_40_MINI
      required_attributes:
        - attribute:
            - name: genai.request.model
            - value: chat gpt-4o-mini
    braintrust_span:
      metrics:
        time_to_first_token: "regex:[0-9]+.[0-9]+"
        tokens: "regex:[0-9]+"
        prompt_tokens: "regex:[0-9]+"
        completion_tokens: "regex:[0-9]+"
      metadata:
        model: gpt-4o-mini
        provider: openai
      span_attributes:
        name: "Chat Completion"
        type: "llm"
      input:
        - content: "you are a helpful assistant"
          role: system
        - content: "What is the capital of France?"
          role: user
      output:
        - finish_reason: stop
          index: 0
          message:
            role: assistant
            content: "The capital of France is Paris."
